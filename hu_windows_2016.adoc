---
sidebar: sidebar 
permalink: hu_windows_2016.html 
keywords: fcp, iscsi, windows, host, utilities, 2016, ontp, luns, configure 
summary: 在 Windows Server 2016 主机上安装 Windows Host Utilities，以帮助您管理ONTAP LUN 的 FCP 和 iSCSI 协议操作。 
---
= 配置 Windows Server 2016 以支持 FCP 和 iSCSI 以及ONTAP存储
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/


[role="lead"]
Windows 主机实用程序使您可以将 Windows 主机连接到NetApp SAN 上的虚拟磁盘 (LUN)。在 Windows Server 2016 主机上安装 Windows 主机实用程序，以帮助您管理ONTAP LUN 的 FCP 和 iSCSI 协议操作。



== 第1步：(可选)启用SAN启动

您可以使用本地启动或 SAN 启动来启动 Windows 操作系统。  NetApp建议使用SAN启动来简化部署并提高可扩展性。

[role="tabbed-block"]
====
.SAN 启动
--
如果您选择使用SAN启动、则您的配置必须支持此功能。

.开始之前
使用 https://mysupport.netapp.com/matrix/#welcome["互操作性表工具"^]验证您的Windows操作系统、主机总线适配器(HBA)、HBA固件、HBA启动BIOS和ONTAP版本是否支持SAN启动。

.步骤
. link:https://docs.netapp.com/us-en/ontap/san-management/index.html["创建 SAN 启动 LUN 并将其映射到主机"^]。
. 在服务器 BIOS 中为 SAN 启动 LUN 映射到的端口启用 SAN 启动。
+
有关如何启用 HBA BIOS 的信息，请参见供应商专用文档。

. 重新启动主机并验证操作系统是否已启动且正在运行、以验证配置是否成功。


--
.本地启动
--
通过将 Windows 操作系统安装到本地硬盘（例如 SSD、SATA 或 RAID）上来执行本地启动。

--
====


== 步骤二：安装Windows热修复程序

NetApp建议在主机服务器上安装Microsoft更新目录中提供的*最新累积更新*。

.步骤
. 从下载修补程序link:https://www.catalog.update.microsoft.com/Search.aspx?q=Update+Windows+Server+2016["Microsoft Update Catalog 2016"^]。



NOTE: 对于无法从Microsoft Update目录下载的修补程序、您需要与Microsoft支持联系。

. 按照 Microsoft 提供的说明安装修补程序。



TIP: 许多热修复程序需要重启Windows主机。您可以等到安装或升级主机实用程序之后再重启主机。



== 步骤 3：安装 Windows 主机实用程序

Windows 主机实用程序是一套软件程序及其文档，可让您将主机连接到NetApp SAN 上的虚拟磁盘 (LUN)。  NetApp建议下载并安装最新的 Windows 主机实用程序，以支持ONTAP LUN 管理并帮助技术支持人员收集配置数据。

有关 Windows 主机实用程序配置和安装信息，请参阅link:https://docs.netapp.com/us-en/ontap-sanhost/hu_wuhu_71_rn.html["Windows Host Utilities"]请查阅文档并选择适合您 Windows 主机实用程序版本的安装步骤。



== 步骤 4：确认主机的多路径配置

如果您的 Windows 主机有多个到存储系统的路径，请安装 Microsoft Multipath I/O (MPIO) 软件并启用多路径。

在 Windows 系统中，MPIO 解决方案的两个主要组件是设备专用模块 (DSM) 和 Windows MPIO。  MPIO 向 Windows 操作系统提供单个磁盘用于所有路径，而 DSM 管理路径故障转移。


CAUTION: 如果不安装MPIO软件、则Windows操作系统可能会将每个路径视为一个单独的磁盘。这可能会导致数据损坏。


NOTE: 在Hyper-V虚拟机中运行的Windows XP或Windows Vista不支持MPIO。

.步骤
. 安装 MPIO 软件并启用多路径功能。
. 在使用FC的系统上选择MPIO时、Host Utilities安装程序会为Emulex和QLogic FC HBA设置所需的超时值。
+
[role="tabbed-block"]
====
.Emulex FC
--
Emulex FC HBA的超时值：

[cols="2*"]
|===
| 属性类型 | 属性值 


| LinkTimeOut | 1. 


| 节点超时 | 10 
|===
--
.QLogic FC
--
QLogic FC HBA的超时值：

[cols="2*"]
|===
| 属性类型 | 属性值 


| LinkDownTimeOut | 1. 


| PortDownRetransCount | 10 
|===
--
====
. 验证ONTAP LUN 的路径状态：
+
根据您的 SAN 配置，主机使用ASA、 AFF或FAS配置来访问ONTAP LUN。这些配置不应该需要超过四条路径来访问单个ONTAP LUN。存储故障时，超过四条路径都可能导致问题。

+
以下示例输出显示了ASA、 AFF或FAS配置的ONTAP LUN 的正确设置。

+
[role="tabbed-block"]
====
.ASA配置
--
ASA配置应包含一组具有单一优先级的活动/优化路径。控制器负责维护路径，并在所有活动路径上发送 I/O。

image::asa.png[具有主动/优化路径的ONTAP LUN的屏幕截图]

--
.AFF或FAS配置
--
AFF或FAS配置应有两组优先级不同的路径。优先级较高的路径是活动/优化路径，由聚合所在的控制器提供服务。优先级较低的路径由不同的控制器提供服务。它们处于活动状态，但未经优化，仅在没有优化路径时使用。

image::nonasa.png[包含两个主动/优化路径和两个主动/非优化路径的ONTAP LUN的屏幕截图]

--
====




== 第五步：回顾已知问题

没有已知问题。



== 下一步是什么？

link:hu_wuhu_hba_settings.html["了解 Window Host Utilities 的注册表设置"]。
