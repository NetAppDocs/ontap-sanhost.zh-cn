---
sidebar: sidebar 
permalink: hu_wuhu_hba_settings.html 
keywords: windows, host, utilities, 7.1, hba, fibre, channel, SANtricity, netapp, san, host, e-series, platform 
summary: Windows Host Utilities包括一个安装程序、用于设置所需的Windows注册表和HBA参数、以便Windows主机正确处理ONTAP和E系列平台的存储系统行为。 
---
= 使用ONTAP存储配置 Windows Host Utilities 的注册表设置
:toc: macro
:hardbreaks:
:toclevels: 1
:allow-uri-read: 
:toc: 
:toclevels: 1
:nofooter: 
:icons: font
:linkattrs: 
:imagesdir: ./media/
:toc-position: content


[role="lead"]
Windows Host Utilities 需要某些注册表和参数设置来验证 Windows 主机是否正确处理存储系统行为。

Windows 主机实用程序设置影响 Windows 主机如何响应数据延迟或丢失的参数值。这些值验证 Windows 主机是否正确处理事件，例如存储系统中的一个控制器到其伙伴控制器的故障转移。

某些值不适用于SANtricity Storage Manager的设备特定模块 (DSM)。  Windows Host Utilities 与SANtricity Storage Manager的 DSM 设置的值之间的重叠不会导致冲突。

您还需要设置 FC、NVMe/FC 和 iSCSI HBA 参数以优化性能并成功处理存储系统事件。

Windows Host Utilities 安装程序将 Windows、FC 和 NVMe/FC HBA 参数设置为支持的值。您需要手动设置iSCSI HBA参数。

当您在安装过程中指定 Microsoft 多路径 I/O (MPIO) 支持时，安装程序会设置不同的值。

[NOTE]
====
安装 Windows Host Utilities 7.2 后，您需要更改 LimTransferSize 参数值。看<<nvme_parameter,NVME 参数>> 。

对于 Windows Host Utilities 8.0、7.2 或 7.1 的所有其他参数和注册表项，您无需更改值，除非技术支持建议您这样做。

====


== Windows Host Utilities 8.0 设置的注册表值

Windows Host Utilities 安装程序会根据您在安装过程中所做的选择自动设置注册表值和 NVMe 参数。您需要检查这些值和操作系统版本。

[role="tabbed-block"]
====
.HKLM 值
--
Windows Host Utilities 安装程序设置以下注册表值。除非另有说明，所有值均为十进制。


NOTE: HKLM是的缩写 `HKEY_LOCAL_MACHINE`。

[cols="20,20,30"]
|===
| 注册表项 | 价值 | 设置时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters \DsmMaximumRetryTimeDuringStateTransition | 120 | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet \Services\msdsm\Parameters \DsmMaximumStateTransitionTime | 120 | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\DsmSupportedDeviceList | “NETAPP LUN”、“NETAPP LUN C 模式” “NVMe NetApp ONTAP Con” | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \IPSecConfigTimeout | 60 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instation_ID \Parameters \LinkDownTime | 10 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Services \ClusDisk \Parameters\ManagementDisksOnSystemBuses | 1. | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \MaxRequestHoldTime | 120 | 未选择 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \MaxRequestHoldTime | 30 个 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \MPDEV\MPIOSupportedDeviceList | “NETAPP LUN”、“NETAPP LUN C 模式”、“NVMe NetApp ONTAP Con” | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathRecoveryInterval | 30 个 | 当您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathVerifyEnabled | 1. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\PathVerifyEnabled | 1. | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services \vnetapp\Parameters\PathVerifyEnabled | 0 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services \MPIO\Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\PDORemovePeriod | 130 | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services\vnetapp \Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\RetransCount | 6. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\RetransyCount | 6. | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\RetransyInterval | 1. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\RetransyInterval | 1. | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 


| HKLM\SYSTEM\CurrentControlSet\Services\vnetapp \Parameters\RetransyInterval | 1. | 指定 MPIO 支持时 


.2+| HKLM\SYSTEM\CurrentControlSet \Services\disk\TimeOutValue | 120 | 未选择 MPIO 支持时 


| 60 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\UseCustomPathRecoveryInterval | 1. | 当指定 MPIO 支持且您的服务器是 Windows Server 2025、2022、2019 或 2016 时 
|===
--
.NVMe参数
--
Windows Host Utilities 8.0 在安装过程中更新以下 NVMe Emulex 驱动程序参数：

* EnableNVMe = 1
* NVMEMode = 0


--
====


== 由Windows Host Utilities 7.2设置的注册表值

Windows Host Utilities 安装程序会根据您在安装过程中所做的选择自动设置注册表值和 NVMe 参数。您需要检查这些值和操作系统版本。

[#nvme_parameter,role="tabbed-block"]
====
.HKLM 值
--
Windows Host Utilities 安装程序设置以下注册表值。除非另有说明，所有值均为十进制。


NOTE: HKLM是的缩写 `HKEY_LOCAL_MACHINE`。

[cols="20,20,30"]
|===
| 注册表项 | 价值 | 设置时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters \DsmMaximumRetryTimeDuringStateTransition | 120 | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet \Services\msdsm\Parameters \DsmMaximumStateTransitionTime | 120 | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\DsmSupportedDeviceList | “NETAPP LUN”、“NETAPP LUN C 模式” “NVMe NetApp ONTAP Con” | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \IPSecConfigTimeout | 60 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instation_ID \Parameters \LinkDownTime | 10 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Services \ClusDisk \Parameters\ManagementDisksOnSystemBuses | 1. | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \MaxRequestHoldTime | 120 | 未选择 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\｛iscsi_driver_GUID｝\ instance_ID \Parameters \MaxRequestHoldTime | 30 个 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Control \MPDEV\MPIOSupportedDeviceList | “NETAPP LUN”、“NETAPP LUN C 模式”、“NVMe NetApp ONTAP Con” | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathRecoveryInterval | 30 个 | 服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathVerifyEnabled | 1. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\PathVerifyEnabled | 1. | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services \vnetapp\Parameters\PathVerifyEnabled | 0 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services \MPIO\Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\PDORemovePeriod | 130 | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services\vnetapp \Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\RetransCount | 6. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\RetransyCount | 6. | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\RetransyInterval | 1. | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\RetransyInterval | 1. | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 


| HKLM\SYSTEM\CurrentControlSet\Services\vnetapp \Parameters\RetransyInterval | 1. | 指定 MPIO 支持时 


.2+| HKLM\SYSTEM\CurrentControlSet \Services\disk\TimeOutValue | 120 | 未选择 MPIO 支持时 


| 60 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\UseCustomPathRecoveryInterval | 1. | 指定了MPIO支持且服务器为Windows Server 2025、2022、2019、2016或2012 R2时 
|===
--
.NVMe参数
--
安装 Windows Host Utilities 7.2 时，将更新以下 NVMe Emulex 驱动程序参数：

* EnableNVMe = 1
* NVMEMode = 0
* 限制传输大小 =1
+
安装Windows Host Utilities 7.2时、LimTransferSize参数会自动设置为"1"。安装后、您需要手动将LimTransferSize值更改为"0"并重新启动服务器。



--
====


== 由Windows Host Utilities 7.1设置的注册表值

Windows Host Utilities 安装程序会根据您在安装过程中所做的选择自动设置注册表值。您需要检查这些注册表值和操作系统版本。

以下值由Windows Host Utilities安装程序设置。除非另有说明、否则所有值均为十进制值。


NOTE: `HKLM` 是的缩写 `HKEY_LOCAL_MACHINE`。

[cols="~, 10, ~"]
|===
| 注册表项 | 价值 | 设置时 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters \DsmMaximumRetryTimeDuringStateTransition | 120 | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters \DsmMaximumStateTransitionTime | 120 | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


.2+| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\DsmSupportedDeviceList | "NETAPPLUN" | 指定 MPIO 支持时 


| "NetApp LUN" ， "NetApp LUN C 模式 " | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Control\Class \ ｛ iscsi_driver_GUID ｝ \ instance_ID\Parameters \IPSecConfigTimeout | 60 | 始终，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Control \Class\ ｛ iscsi_driver_GUID ｝ \ instance_ID\Parameters\LinkDownTime | 10 | 始终 


| HKLM\SYSTEM\CurrentControlSet\Services\ClusDisk \Parameters\ManagementDisksOnSystemBuses | 1. | 始终，除非检测到 Data ONTAP DSM 


.2+| HKLM\SYSTEM\CurrentControlSet\Control \Class\ ｛ iscsi_driver_GUID ｝ \ instance_ID\Parameters\MaxRequestHoldTime | 120 | 未选择 MPIO 支持时 


| 30 个 | 始终，除非检测到 Data ONTAP DSM 


.2+| HKLM\SYSTEM\CurrentControlSet \Control\MPDEV\MPIOSupportedDeviceList | "NetApp LUN" | 指定 MPIO 支持时 


| "NetApp LUN" ， "NetApp LUN C 模式 " | 如果指定了 MPIO ，则检测到 Data ONTAP DSM 除外 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathRecoveryInterval | 40 | 如果您的服务器仅为 Windows Server 2008 ， Windows Server 2008 R2 ， Windows Server 2012 ， Windows Server 2012 R2 或 Windows Server 2016 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PathVerifyEnabled | 0 | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\PathVerifyEnabled | 0 | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\PathVerifyEnabled | 0 | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \msiscdsm\Parameters\PathVerifyEnabled | 0 | 指定了 MPIO 支持且您的服务器为 Windows Server 2003 时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\vnetapp \Parameters\PathVerifyEnabled | 0 | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\PDORemovePeriod | 130 | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\msiscdsm \Parameters\PDORemovePeriod | 130 | 指定了 MPIO 支持且您的服务器为 Windows Server 2003 时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \vnetapp \Parameters\PDORemovePeriod | 130 | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \MPIO\Parameters\RetransyCount | 6. | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services\msdsm \Parameters\RetransyCount | 6. | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \msiscdsm\Parameters\RetransyCount | 6. | 指定了 MPIO 支持且您的服务器为 Windows Server 2003 时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \vnetapp\Parameters\RetransyCount | 6. | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \MPIO\Parameters\RetransyInterval | 1. | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \msdsm\Parameters\RetransyInterval | 1. | 指定了MPIO支持且您的服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时、除非检测到Data ONTAP DSM 


| HKLM\SYSTEM\CurrentControlSet\Services \vnetapp\Parameters\RetransyInterval | 1. | 指定 MPIO 支持时，除非检测到 Data ONTAP DSM 


.2+| HKLM\SYSTEM\CurrentControlSet \Services\disk\TimeOutValue | 120 | 未选择 MPIO 支持时 


| 60 | 指定 MPIO 支持时 


| HKLM\SYSTEM\CurrentControlSet\Services\MPIO \Parameters\UseCustomPathRecoveryInterval | 1. | 服务器为Windows Server 2016、2012 R2、2012、2008 R2或2008时 
|===
请参见 https://docs.microsoft.com/en-us/troubleshoot/windows-server/performance/windows-registry-advanced-users["Microsoft 文档"^] 有关注册表参数的详细信息。



== Windows Host Utilities 设置的 FC HBA 值

Windows Host Utilities 安装程序为使用 FC 的系统上的 Emulex 和 QLogic FC HBA 设置所需的超时值。

安装程序为 Emulex FC HBA 设置以下参数：

[role="tabbed-block"]
====
.当您选择 MPIO 时
--
|===
| 属性类型 | 属性值 


| LinkTimeOut | 1. 


| 节点超时 | 10 
|===
--
.当您不选择 MPIO
--
|===
| 属性类型 | 属性值 


| LinkTimeOut | 30 个 


| 节点超时 | 120 
|===
--
====
安装程序为 QLogic FC HBA 设置以下参数：

[role="tabbed-block"]
====
.当您选择 MPIO 时
--
|===
| 属性类型 | 属性值 


| LinkDownTimeOut | 1. 


| PortDownRetransCount | 10 
|===
--
.当您不选择 MPIO
--
|===
| 属性类型 | 属性值 


| LinkDownTimeOut | 30 个 


| PortDownRetransCount | 120 
|===
--
====

NOTE: 根据程序的不同，这些参数的名称可能会略有不同。
例如、在QLogic QConvergeConsole程序中、参数显示为 `Link Down Timeout`。
Host Utilities `fcconfig.ini` file将此参数显示为 `LinkDownTimeOut` 或 `MpioLinkDownTimeOut`、具体取决于是否指定MPIO。但是，所有这些名称都引用相同的 HBA 参数。请参见 https://www.broadcom.com/support/download-search["Emulex"^] 或 https://driverdownloads.qlogic.com/QLogicDriverDownloads_UI/Netapp_search.aspx["QLogic"^] 以了解有关超时参数的更多信息。



== 了解 Host Utilities 对 FC HBA 驱动程序设置的更改

在 FC 系统上安装所需的 Emulex 或 QLogic HBA 驱动程序期间，Windows Host Utilities 会检查多个参数，在某些情况下还会修改这些参数。

如果检测到 MS DSM for Windows MPIO，Windows Host Utilities 将设置以下参数的值：

* *LinkTimeOut*：定义物理链路断开后主机端口恢复 I/O 之前等待的时间长度（以秒为单位）。
* *NodeTimeOut*：定义主机端口识别到目标设备的连接断开之前的时间长度（以秒为单位）。


在对 HBA 问题进行故障排除时，请检查以确保这些设置具有正确的值。正确的值取决于两个因素：

* HBA 供应商
* 是否正在使用 MPIO 软件。


您可以通过以下方式更正 HBA 设置link:hu_wuhu_repair_remove.html["运行修复选项"]在 Windows Host Utilities 安装程序中。

[role="tabbed-block"]
====
.Emulex HBA驱动程序
--
验证 FC 系统上的 Emulex HBA 驱动程序设置。HBA 上的每个端口都必须存在这些设置。

.步骤
. 打开 OnCommand 管理器。
. 从列表中选择适当的 HBA，然后选择“*驱动程序参数*”选项卡。
+
此时将显示驱动程序参数。

+
.. 如果您使用的是 MPIO 软件，请确保您具有以下驱动程序设置：
+
*** LinkTimeOut — 1.
*** 节点超时 - 10


.. 如果您不使用 MPIO 软件，请确保您具有以下驱动程序设置：
+
*** LinkTimeOut — 30
*** 节点超时 - 120






--
.QLogic HBA驱动程序
--
验证 FC 系统上的 QLogic HBA 驱动程序设置。HBA 上的每个端口都必须存在这些设置。

.步骤
. 打开 QConvergeConsole，然后在工具栏上选择 *连接*。
+
此时将显示*连接到主机*对话框。

. 从列表中选择相应的主机、然后选择*连接*。
+
此时， FC HBA 窗格中将显示 HBA 列表。

. 从列表中选择相应的HBA端口、然后选择*设置*选项卡。
. 从 * 选择设置 * 部分中选择 * 高级 HBA 端口设置 * 。
. 如果您使用的是MPIO软件、请验证您是否具有以下驱动程序设置：
+
** 链路关闭超时（ linkdwnto ）— 1.
** 端口关闭重试计数（ portdwnrc ）— 10


. 如果您没有使用 MPIO 软件，请验证您是否具有以下驱动程序设置：
+
** 链路关闭超时（ linkdwnto ）— 30
** 端口关闭重试计数（ portdwnrc ）— 120




--
====